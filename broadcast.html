<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>타이머 컨트롤</title>
<style>
  body {
    font-family: 'Arial', sans-serif;
    background: #222;
    color: white;
    padding: 20px;
    text-align: center;
  }
  h2 { margin-bottom: 20px; }
  #currentTime {
    font-size: 50px;
    margin: 20px 0;
    color: #FF69B4;
    text-shadow: 2px 2px 5px rgba(0,0,0,0.6);
  }
  input {
    font-size: 22px;
    width: 80px;
    padding: 10px;
    border-radius: 8px;
    border: none;
    margin-right: 10px;
  }
  button {
    font-size: 20px;
    padding: 10px 20px;
    margin: 5px;
    border: none;
    border-radius: 8px;
    background: #FF69B4;
    color: white;
    cursor: pointer;
    transition: background 0.2s;
  }
  button:hover { background: #FF1493; }
  iframe {
    width: 100%;
    height: 200px;
    border: 2px solid #FF69B4;
    border-radius: 8px;
    margin-top: 20px;
  }
</style>
</head>
<body>

<h2>타이머 컨트롤</h2>

<input type="number" id="minutes" placeholder="분" min="0">
<input type="number" id="seconds" placeholder="초" min="0" max="59">
<button onclick="setTimer()">설정</button>
<br>
<button onclick="startTimer()">Start</button>
<button onclick="pauseTimer()">Pause</button>
<button onclick="resetTimer()">Reset</button>

<div id="currentTime">00:00</div>

<iframe id="broadcastFrame" src="broadcast.html"></iframe>

<script>
let localTime = 0;
let localTimerId = null;
const broadcastFrame = document.getElementById("broadcastFrame");

function postToBroadcast(action, time=0) {
  broadcastFrame.contentWindow.postMessage({action, time}, "*");
}

function setTimer() {
  const minutes = parseInt(document.getElementById("minutes").value) || 0;
  const seconds = parseInt(document.getElementById("seconds").value) || 0;
  if (seconds >= 0 && seconds < 60) {
    localTime = minutes * 60 + seconds;
    updateDisplay();
    postToBroadcast("set", localTime);
  } else {
    alert("초는 0~59 사이로 입력해주세요.");
  }
}

function startTimer() {
  if (!localTimerId) {
    const endTime = Date.now() + localTime * 1000;
    localTimerId = setInterval(() => {
      const remaining = Math.round((endTime - Date.now()) / 1000);
      if (remaining >= 0) {
        localTime = remaining;
        updateDisplay();
      } else {
        clearInterval(localTimerId);
        localTimerId = null;
        localTime = 0;
        updateDisplay();
      }
    }, 250);
    postToBroadcast("start");
  }
}

function pauseTimer() {
  clearInterval(localTimerId);
  localTimerId = null;
  postToBroadcast("pause");
}

function resetTimer() {
  clearInterval(localTimerId);
  localTimerId = null;
  localTime = 0;
  updateDisplay();
  postToBroadcast("reset");
}

function updateDisplay() {
  const minutes = Math.floor(localTime / 60);
  const seconds = localTime % 60;
  document.getElementById("currentTime").textContent =
    String(minutes).padStart(2,'0') + ":" + String(seconds).padStart(2,'0');
}

window.addEventListener("message", (event) => {
  const data = event.data;
  if (!data.action) return;
  if (data.action === "set") {
    localTime = data.time;
    updateDisplay();
  } else if (data.action === "start") {
    startTimer();
  } else if (data.action === "pause") {
    pauseTimer();
  } else if (data.action === "reset") {
    resetTimer();
  }
});

updateDisplay();
</script>

</body>
</html>
